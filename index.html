<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sparta Movie</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&family=Roboto:wght@400;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="./src/css/common.css" />
  <link rel="stylesheet" href="./src/css/main.css" />

</head>

<body>

  <header>
    <a href="/index.html" class="logo">
      <span>KDH</span>
    </a>
    <nav>
      <ul>
        <li>
          <a href="/index.html" class="header_home active">
            검색
          </a>
        </li>
        <li>
          <a href="/detail.html" class="header_info">
            정보
          </a>
        </li>

      </ul>
    </nav>


  </header>
  <router-view>
    <div class="container">
      <div class="headline">
        <h1>
          <span>TMDB API</span> THE OPEN MOVIE DATABASE
        </h1>
      </div>
      <div class="search">
        <input value="" placeholder="Enter the movie title to search!" />

        <button class="btn btn-primary">
          Search!
        </button>
      </div>
      <div class="movie-list">
        <div class="movies"></div>
        <div class="the-loader hiden"></div>
      </div>
    </div>
    <button class="btn view-more">View more..</button>

  </router-view>

</body>
<script type="module">
  import { getMovies, findByTitle, findByOneDetail } from './src/movies.js'
  import { drawItems } from './src/drawItems.js'

  const moviesEl = document.querySelector(".movies");
  const btnEl = document.querySelector(".btn");
  const viewMoreEl = document.querySelector(".view-more");
  const url = new URL(window.location.href)
  const inputEl = document.querySelector("input");
  let page = url.searchParams.get('page') ? url.searchParams.get('page') : 1

  let x = await getMovies(page)
  let text = draw(x)
  console.log(x)
  moviesEl.innerHTML = text
  let findText = null;

  btnEl.addEventListener('click', async () =>
  {
    page = 1
    findText = inputEl.value;
    if (!findText)
    {
      alert("please input search item")
    } else
    {
      let y = await findByTitle(findText, page)
      if (y.length < 20)
      {
        viewMoreEl.setAttribute("class", "hidden")
      }
      text = draw(y)
      moviesEl.innerHTML = text
    }
  })
  viewMoreEl.addEventListener('click', async () =>
  {
    page += 1;
    if (findText)
    {
      let add = await findByTitle(findText, page)
      text += draw(add)
    } else
    {
      let add = await getMovies(page)
      text += draw(add)
    }
    moviesEl.innerHTML = text
  })

  function draw(x)
  {
    let text = ''
    for (let i = 0; i < x.length; i++)
    {
      text += drawItems(x[i])
    }
    return text
  }

</script>

</html>